From 7c5b10c34d25aaf6f9104241a761a621c8c4eaf0 Mon Sep 17 00:00:00 2001
From: codex <codex@openai.com>
Date: Sun, 20 Jul 2025 16:01:24 +0000
Subject: [PATCH] feat: add telegram auth endpoint to server.js

---
 backend/server.js | 24 ++++++++++++++++++++++++
 1 file changed, 24 insertions(+)
 create mode 100644 backend/server.js

diff --git a/backend/server.js b/backend/server.js
new file mode 100644
index 0000000..2f6f0fd
--- /dev/null
+++ b/backend/server.js
@@ -0,0 +1,24 @@
+// === Telegram Auth Endpoint ===
+app.post('/api/auth/telegram', (req, res) => {
+  const { hash, ...data } = req.body;
+  const secret = require('crypto')
+    .createHash('sha256')
+    .update(process.env.TELEGRAM_BOT_TOKEN || '')
+    .digest();
+  const checkString = Object.entries(data)
+    .sort(([a], [b]) => a.localeCompare(b))
+    .map(([k, v]) => `${k}=${v}`)
+    .join('\n');
+  const computedHash = require('crypto')
+    .createHmac('sha256', secret)
+    .update(checkString)
+    .digest('hex');
+  if (computedHash !== hash) {
+    return res.status(403).json({ error: 'Invalid signature' });
+  }
+  const sessionToken = require('crypto').randomUUID();
+  const oneDay = 60 * 60 * 24;
+  res.setHeader('Set-Cookie', `auth_token=${sessionToken}; Path=/; Max-Age=${oneDay}; HttpOnly; SameSite=Strict`);
+  return res.status(200).json({ ok: true });
+});
+// === End Telegram Auth ===
\ No newline at end of file
-- 
2.39.2

